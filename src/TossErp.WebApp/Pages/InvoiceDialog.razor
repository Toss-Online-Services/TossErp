@using System.Globalization

<MudDialog>
    <DialogContent>
        <MudContainer Style="max-height: 500px; overflow-y: auto">
            <MudPaper Elevation="0" Class="pa-4">
                <!-- Header -->
                <MudGrid>
                    <MudItem xs="6">
                        <MudImage Src="_content/TossErp.WebApp/images/logo.png" Height="60" Alt="TOSS ERP" />
                        <MudText Typo="Typo.h6" Class="mt-2">TOSS ERP PTY LTD</MudText>
                        <MudText>123 Main Street</MudText>
                        <MudText>Johannesburg, 2000</MudText>
                        <MudText>South Africa</MudText>
                        <MudText>VAT: 123456789</MudText>
                    </MudItem>
                    <MudItem xs="6" Class="text-right">
                        <MudText Typo="Typo.h5">INVOICE</MudText>
                        <MudText Typo="Typo.subtitle2" Class="mt-2">Invoice Number</MudText>
                        <MudText>@InvoiceNumber</MudText>
                        <MudText Typo="Typo.subtitle2" Class="mt-2">Date</MudText>
                        <MudText>@_invoice.Date.ToString("dd MMMM yyyy")</MudText>
                    </MudItem>
                </MudGrid>

                <MudDivider Class="my-6"/>

                <!-- Customer Info -->
                <MudGrid>
                    <MudItem xs="6">
                        <MudText Typo="Typo.subtitle1" Class="mb-2">Bill To:</MudText>
                        <MudText Typo="Typo.body1">@_invoice.CustomerName</MudText>
                        <MudText>@_invoice.CustomerAddress</MudText>
                        <MudText>@_invoice.CustomerEmail</MudText>
                        <MudText>@_invoice.CustomerPhone</MudText>
                    </MudItem>
                    <MudItem xs="6" Class="text-right">
                        <MudText Typo="Typo.subtitle1" Class="mb-2">Payment Details:</MudText>
                        <MudText>Method: @_invoice.PaymentMethod</MudText>
                        <MudText>Status: 
                            <MudChip Color="@_invoice.StatusColor" Size="Size.Small">
                                @_invoice.Status
                            </MudChip>
                        </MudText>
                        @if (!string.IsNullOrEmpty(_invoice.PaymentReference))
                        {
                            <MudText>Reference: @_invoice.PaymentReference</MudText>
                        }
                    </MudItem>
                </MudGrid>

                <MudDivider Class="my-6"/>

                <!-- Items -->
                <MudTable Items="@_invoice.Items" Dense="true" Hover="true" Bordered="false">
                    <HeaderContent>
                        <MudTh>Item</MudTh>
                        <MudTh>Description</MudTh>
                        <MudTh Style="text-align: right">Quantity</MudTh>
                        <MudTh Style="text-align: right">Unit Price</MudTh>
                        <MudTh Style="text-align: right">Total</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Item">@context.Name</MudTd>
                        <MudTd DataLabel="Description">@context.Description</MudTd>
                        <MudTd DataLabel="Quantity" Style="text-align: right">@context.Quantity</MudTd>
                        <MudTd DataLabel="Unit Price" Style="text-align: right">
                            R @context.UnitPrice.ToString("N2")
                        </MudTd>
                        <MudTd DataLabel="Total" Style="text-align: right">
                            R @((context.Quantity * context.UnitPrice).ToString("N2"))
                        </MudTd>
                    </RowTemplate>
                </MudTable>

                <!-- Summary -->
                <div class="d-flex justify-end mt-4">
                    <MudPaper Elevation="0" Class="pa-4" Style="width: 300px">
                        <div class="d-flex justify-space-between mb-2">
                            <MudText>Subtotal:</MudText>
                            <MudText>R @_invoice.Subtotal.ToString("N2")</MudText>
                        </div>
                        <div class="d-flex justify-space-between mb-2">
                            <MudText>VAT (15%):</MudText>
                            <MudText>R @_invoice.Vat.ToString("N2")</MudText>
                        </div>
                        @if (_invoice.Discount > 0)
                        {
                            <div class="d-flex justify-space-between mb-2">
                                <MudText>Discount:</MudText>
                                <MudText Color="Color.Error">-R @_invoice.Discount.ToString("N2")</MudText>
                            </div>
                        }
                        <MudDivider Class="my-2"/>
                        <div class="d-flex justify-space-between">
                            <MudText Typo="Typo.h6">Total:</MudText>
                            <MudText Typo="Typo.h6">R @_invoice.Total.ToString("N2")</MudText>
                        </div>
                    </MudPaper>
                </div>

                <!-- Notes -->
                @if (!string.IsNullOrEmpty(_invoice.Notes))
                {
                    <MudPaper Elevation="0" Class="mt-6 pa-4">
                        <MudText Typo="Typo.subtitle1" Class="mb-2">Notes:</MudText>
                        <MudText>@_invoice.Notes</MudText>
                    </MudPaper>
                }

                <!-- Terms -->
                <MudPaper Elevation="0" Class="mt-6 pa-4">
                    <MudText Typo="Typo.subtitle1" Class="mb-2">Terms & Conditions:</MudText>
                    <MudText>1. Payment is due within 30 days</MudText>
                    <MudText>2. Please include invoice number in payment reference</MudText>
                    <MudText>3. All prices include VAT</MudText>
                </MudPaper>
            </MudPaper>
        </MudContainer>
    </DialogContent>
    
    <DialogActions>
        <MudButton OnClick="Cancel">Close</MudButton>
        <MudButton Variant="Variant.Outlined" Color="Color.Primary"
                  StartIcon="@Icons.Material.Filled.LocalPrintshop"
                  OnClick="Print">
            Print
        </MudButton>
        <MudButton Variant="Variant.Outlined" Color="Color.Primary"
                  StartIcon="@Icons.Material.Filled.PictureAsPdf"
                  OnClick="DownloadPdf">
            Download PDF
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    [Parameter] public string InvoiceNumber { get; set; }
    
    private class InvoiceItem
    {
        public string Name { get; set; }
        public string Description { get; set; }
        public int Quantity { get; set; }
        public decimal UnitPrice { get; set; }
    }
    
    private class Invoice
    {
        public DateTime Date { get; set; }
        public string CustomerName { get; set; }
        public string CustomerAddress { get; set; }
        public string CustomerEmail { get; set; }
        public string CustomerPhone { get; set; }
        public string PaymentMethod { get; set; }
        public string PaymentReference { get; set; }
        public string Status { get; set; }
        public List<InvoiceItem> Items { get; set; }
        public decimal Subtotal { get; set; }
        public decimal Vat { get; set; }
        public decimal Discount { get; set; }
        public decimal Total { get; set; }
        public string Notes { get; set; }
        
        public Color StatusColor => Status switch
        {
            "Completed" => Color.Success,
            "Pending" => Color.Warning,
            "Cancelled" => Color.Error,
            "Refunded" => Color.Info,
            _ => Color.Default
        };
    }
    
    private Invoice _invoice = new()
    {
        Date = DateTime.Now,
        CustomerName = "John Smith",
        CustomerAddress = "456 Oak Street, Pretoria, 0002",
        CustomerEmail = "john.smith@email.com",
        CustomerPhone = "+27 12 345 6789",
        PaymentMethod = "Credit Card",
        PaymentReference = "REF123456",
        Status = "Completed",
        Items = new List<InvoiceItem>
        {
            new() { Name = "Samsung Galaxy S21", Description = "128GB, Phantom Black", 
                   Quantity = 1, UnitPrice = 15999.99m },
            new() { Name = "Phone Case", Description = "Protective Case for S21", 
                   Quantity = 1, UnitPrice = 299.99m },
            new() { Name = "Screen Protector", Description = "Tempered Glass", 
                   Quantity = 2, UnitPrice = 149.99m }
        },
        Subtotal = 16599.96m,
        Vat = 2489.99m,
        Discount = 500.00m,
        Total = 18589.95m,
        Notes = "Thank you for your business!"
    };
    
    private void Cancel() => MudDialog.Cancel();
    
    private async Task Print()
    {
        // In a real application, this would print the invoice
        Snackbar.Add($"Invoice {InvoiceNumber} sent to printer!", Severity.Success);
    }
    
    private async Task DownloadPdf()
    {
        // In a real application, this would generate and download a PDF
        Snackbar.Add($"Invoice {InvoiceNumber} downloaded as PDF!", Severity.Success);
    }
} 