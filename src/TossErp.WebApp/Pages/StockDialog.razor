<MudDialog>
    <DialogContent>
        <MudContainer Style="max-height: 500px; overflow-y: auto">
            <MudForm @ref="_form" @bind-IsValid="@_isValid">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="_item.Name" Label="Item Name"
                                    Required="true" RequiredError="Item name is required" />
                    </MudItem>
                    
                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="_item.Sku" Label="SKU"
                                    Required="true" RequiredError="SKU is required" />
                    </MudItem>
                    
                    <MudItem xs="12" md="6">
                        <MudSelect T="string" @bind-Value="_item.Category" Label="Category"
                                 Required="true" RequiredError="Category is required">
                            @foreach (var category in _categories)
                            {
                                <MudSelectItem Value="@category">@category</MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    
                    <MudItem xs="12" md="6">
                        <MudNumericField @bind-Value="_item.UnitPrice" Label="Unit Price"
                                       Required="true" RequiredError="Unit price is required"
                                       Min="0" Format="N2" Adornment="Adornment.Start"
                                       AdornmentText="R" />
                    </MudItem>
                    
                    <MudItem xs="12" md="6">
                        <MudNumericField @bind-Value="_item.InStock" Label="Current Stock"
                                       Required="true" RequiredError="Current stock is required"
                                       Min="0" />
                    </MudItem>
                    
                    <MudItem xs="12" md="6">
                        <MudNumericField @bind-Value="_item.MinLevel" Label="Minimum Stock Level"
                                       Required="true" RequiredError="Minimum stock level is required"
                                       Min="0" />
                    </MudItem>
                    
                    <MudItem xs="12">
                        <MudTextField @bind-Value="_item.Description" Label="Description"
                                    Lines="3" />
                    </MudItem>
                    
                    <MudItem xs="12">
                        <MudExpansionPanels>
                            <MudExpansionPanel Text="Additional Details">
                                <MudGrid>
                                    <MudItem xs="12" md="6">
                                        <MudTextField @bind-Value="_item.Barcode" Label="Barcode" />
                                    </MudItem>
                                    
                                    <MudItem xs="12" md="6">
                                        <MudTextField @bind-Value="_item.Location" Label="Storage Location" />
                                    </MudItem>
                                    
                                    <MudItem xs="12" md="6">
                                        <MudSelect T="string" @bind-Value="_item.Supplier" Label="Supplier">
                                            <MudSelectItem Value="@("supplier1")">Supplier 1</MudSelectItem>
                                            <MudSelectItem Value="@("supplier2")">Supplier 2</MudSelectItem>
                                            <MudSelectItem Value="@("supplier3")">Supplier 3</MudSelectItem>
                                        </MudSelect>
                                    </MudItem>
                                    
                                    <MudItem xs="12" md="6">
                                        <MudNumericField @bind-Value="_item.ReorderQuantity" 
                                                       Label="Reorder Quantity"
                                                       Min="0" />
                                    </MudItem>
                                </MudGrid>
                            </MudExpansionPanel>
                        </MudExpansionPanels>
                    </MudItem>
                </MudGrid>
            </MudForm>
        </MudContainer>
    </DialogContent>
    
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" 
                  OnClick="Submit" Disabled="!_isValid">
            @(_item.Id == 0 ? "Add Item" : "Save Changes")
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    [Parameter] public StockItem Item { get; set; }
    
    private MudForm _form;
    private bool _isValid;
    private StockItem _item = new();
    
    private List<string> _categories = new()
    {
        "Electronics",
        "Clothing",
        "Food & Beverages",
        "Home & Garden",
        "Sports & Outdoors"
    };
    
    protected override void OnInitialized()
    {
        if (Item != null!)
        {
            _item = new StockItem
            {
                Id = Item.Id,
                Sku = Item.Sku,
                Name = Item.Name,
                Category = Item.Category,
                Description = Item.Description,
                UnitPrice = Item.UnitPrice,
                InStock = Item.InStock,
                MinLevel = Item.MinLevel,
                Status = Item.Status,
                Barcode = Item.Barcode,
                Location = Item.Location,
                Supplier = Item.Supplier,
                ReorderQuantity = Item.ReorderQuantity
            };
        }
    }
    
    private void Cancel() => MudDialog.Cancel();
    
    private async Task Submit()
    {
        await _form.Validate();
        
        if (_isValid)
        {
            MudDialog.Close(DialogResult.Ok(_item));
        }
    }
    
    public class StockItem
    {
        public int Id { get; set; }
        public string Sku { get; set; }
        public string Name { get; set; }
        public string Category { get; set; }
        public string Description { get; set; }
        public decimal UnitPrice { get; set; }
        public int InStock { get; set; }
        public int MinLevel { get; set; }
        public string Status { get; set; }
        public string Barcode { get; set; }
        public string Location { get; set; }
        public string Supplier { get; set; }
        public int ReorderQuantity { get; set; }
    }
} 