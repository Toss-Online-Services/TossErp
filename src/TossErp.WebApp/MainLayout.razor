@inherits LayoutComponentBase
@using TossErp.WebApp.Services
@using TossErp.WebApp.Shared
@inject NavigationManager Navigation
@inject ILocalStorageService LocalStorage
@inject ISnackbar Snackbar

<MudThemeProvider @bind-IsDarkMode="_isDarkMode" Theme="_theme"/>
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
        <MudImage Src="_content/TossErp.WebApp/images/logo.png" Height="40" Alt="TOSS ERP" Class="ml-3 mr-4" />
        <MudText Typo="Typo.h6">TOSS ERP</MudText>
        <MudSpacer />
        
        <MudTooltip Text="Toggle Dark Mode">
            <MudIconButton Icon="@(_isDarkMode ? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode)" 
                          Color="Color.Inherit" OnClick="@((e) => _isDarkMode = !_isDarkMode)" />
        </MudTooltip>
        
        <MudMenu Dense="true">
            <ActivatorContent>
                <MudBadge Content="4" Color="Color.Error" Overlap="true" Class="mx-3">
                    <MudIconButton Icon="@Icons.Material.Filled.Notifications" Color="Color.Inherit" />
                </MudBadge>
            </ActivatorContent>
            <ChildContent>
                <MudText Class="px-4 py-2"><b>Notifications</b></MudText>
                <MudDivider />
                <MudMenuItem>
                    <div class="d-flex">
                        <MudIcon Icon="@Icons.Material.Filled.Inventory" Class="mr-2" />
                        <div>
                            <MudText>Low stock alert: Item XYZ</MudText>
                            <MudText Typo="Typo.caption">2 minutes ago</MudText>
                        </div>
                    </div>
                </MudMenuItem>
                <MudMenuItem>
                    <div class="d-flex">
                        <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Class="mr-2" />
                        <div>
                            <MudText>New sale completed</MudText>
                            <MudText Typo="Typo.caption">10 minutes ago</MudText>
                        </div>
                    </div>
                </MudMenuItem>
            </ChildContent>
        </MudMenu>

        <MudMenu Dense="true">
            <ActivatorContent>
                <MudAvatar Color="Color.Secondary">JD</MudAvatar>
            </ActivatorContent>
            <ChildContent>
                <MudCard Elevation="0" Square="true" Class="pa-4" Style="min-width: 200px;">
                    <MudText>John Doe</MudText>
                    <MudText Typo="Typo.caption">Administrator</MudText>
                </MudCard>
                <MudDivider />
                <MudMenuItem Icon="@Icons.Material.Filled.Person">Profile</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Settings">Settings</MudMenuItem>
                <MudMenuItem Icon="@Icons.Material.Filled.Translate" OnClick="@ToggleLanguage">
                    @(_currentLanguage == "en" ? "Switch to Afrikaans" : "Switch to English")
                </MudMenuItem>
                <MudDivider />
                <MudMenuItem Icon="@Icons.Material.Filled.Logout" OnClick="Logout">Logout</MudMenuItem>
            </ChildContent>
        </MudMenu>
    </MudAppBar>
    
    <MudDrawer @bind-Open="_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2" Variant="@DrawerVariant.Mini">
        <NavMenu />
    </MudDrawer>
    
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pt-4">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private bool _isDarkMode;
    private string _currentLanguage = "en";
    
    private MudTheme _theme = new();

    private void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    private async Task Logout()
    {
        await LocalStorage.RemoveItemAsync("authToken");
        await LocalStorage.RemoveItemAsync("user");
        Navigation.NavigateTo("/login");
    }
    
    private void ToggleLanguage()
    {
        _currentLanguage = _currentLanguage == "en" ? "af" : "en";
        Snackbar.Add($"Language switched to {(_currentLanguage == "en" ? "English" : "Afrikaans")}", Severity.Success);
    }
} 