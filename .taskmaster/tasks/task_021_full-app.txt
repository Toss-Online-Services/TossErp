# Task ID: 21
# Title: HR/Payroll Service (MVP)
# Status: pending
# Dependencies: 1, 7, 27, 28
# Priority: medium
# Description: Employees, payroll runs, leave/attendance, statutory deductions; integrates with Accounting.
# Details:
Scope: Employee, Department, Role, Leave, Attendance, PayrollRun, Payslip, Deduction, Benefit. APIs for CRUD and processes; events to Accounting (payroll expense, cash out).

# Test Strategy:


# Subtasks:
## 1. HR: Database schema + migrations [pending]
### Dependencies: None
### Description: Schema design (Employee, Department, Leave, Attendance, PayrollRun, Payslip, Deduction, Benefit) with constraints.
### Details:
Acceptance:
- Postgres DDL with RLS by TenantId
- Foreign keys, unique constraints, indexes on lookups and dates
- Liquibase/EF migrations ready
- ER diagram updated in docs

## 2. HR: Domain + API endpoints [pending]
### Dependencies: None
### Description: CRUD and processes for Employee, Leave, Attendance, PayrollRun, Payslip with validations
### Details:
Acceptance:
- CQRS handlers + validators
- REST endpoints with scopes, idempotency, RFC9457
- Payroll run creates payslips; locking rules
- Swagger examples + tests

## 3. HR: Payroll calculations engine [pending]
### Dependencies: None
### Description: Rules for earnings, deductions, taxes, benefits; country overrides
### Details:
Acceptance:
- Pluggable rules; unit tests for scenarios
- Rounding and retro adjustments
- Audit trail for calculations
- Performance baseline for 1k payslips

## 4. HR: Integrations (Accounting, Notifications) [pending]
### Dependencies: None
### Description: Post payroll journal entries; notify employees; download payslips
### Details:
Acceptance:
- Events to Accounting (expense, payable)
- Notification templates for payslips
- PDF payslip generation + secure download
- E2E tests

## 5. HR: Admin UI (web) [pending]
### Dependencies: None
### Description: Admin screens for employees, leave/attendance, payroll setup
### Details:
Acceptance:
- CRUD pages; filters; bulk import/export via Jobs API
- Access control per role
- Cypress tests for critical flows

## 6. HR: Tests + docs [pending]
### Dependencies: None
### Description: Unit/integration/API tests and documentation
### Details:
Acceptance:
- Unit tests coverage â‰¥ 70%
- Integration tests for payroll run
- API docs with examples; runbook for payroll month-end

