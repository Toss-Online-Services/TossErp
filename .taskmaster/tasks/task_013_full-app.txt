# Task ID: 13
# Title: Nuxt 3 Web App (MVP)
# Status: in-progress
# Dependencies: 4, 5, 7, 8, 11
# Priority: high
# Description: Admin dashboards, advanced stock, sales back-office, customers
# Details:
Back-office web for management and reporting

# Test Strategy:


# Subtasks:
## 1. Nuxt: Env & runtime config (dev/staging/prod) [pending]
### Dependencies: None
### Description: Runtime config per environment with safe public/private vars.
### Details:
Acceptance:
- .env files for dev/staging/prod; .env.example added
- nuxt.config.ts uses runtimeConfig/public for API base, tenant, log level
- NUXT_PUBLIC_* only for safe values; secrets not committed
- Docs: how to run with each env

## 2. Nuxt: API client (ofetch/axios) + interceptors [pending]
### Dependencies: 13.1
### Description: HTTP client with interceptors and typed errors.
### Details:
Acceptance:
- ofetch/axios wrapper with interceptors: Authorization, Idempotency-Key (POST/PUT), X-Correlation-ID
- Retry/backoff on 5xx/network
- RFC9457 ProblemDetails mapped to typed error (+toasts)
- Unit tests for interceptor logic

## 3. Nuxt: Auth/session + refresh [pending]
### Dependencies: 13.2
### Description: Login, session persistence, refresh, and logout.
### Details:
Acceptance:
- Login page â†’ stores JWT + refresh securely (httpOnly cookie if feasible)
- Auto-refresh; 401 leads to logout and redirect
- Me endpoint on boot; skeleton while loading
- Tests for happy/edge paths

## 4. Nuxt: RBAC route middleware + v-can directive [pending]
### Dependencies: 13.3
### Description: Protect routes and conditionally render actions based on permissions.
### Details:
Acceptance:
- Route middleware checks roles/scopes; denies with friendly page
- v-can directive/composable hides disabled actions
- Tests for middleware and directive

## 5. Nuxt: App shell/layout + navigation + error boundary [pending]
### Dependencies: 13.4
### Description: Global layout, navigation, and error boundary.
### Details:
Acceptance:
- Default layout with nav/sidebar, breadcrumbs, user menu
- Global error boundary surfaces ProblemDetails nicely
- Toast/notification plugin and loading bar
- Snapshot tests for layout

## 6. Nuxt: Stock management data table (server-side) [pending]
### Dependencies: 13.2
### Description: Server-side data table with filters, sorts, and bulk actions.
### Details:
Acceptance:
- Stock list page with server pagination, filter chips, sort
- Bulk select + export CSV
- Column show/hide + saved views
- Component tests and API mocks

## 7. Nuxt: Bulk import/export via Jobs API [pending]
### Dependencies: 13.6
### Description: Import/export flows for stock and customers using Jobs API.
### Details:
Acceptance:
- Import wizard (CSV/XLSX) starts async job; poll status; show errors
- Export current view to CSV via Jobs API
- File validation + sample templates
- E2E tests with Cypress

## 8. Nuxt: Stock ledger + movements views [pending]
### Dependencies: None
### Description: Stock ledger and movement views with filtering and drill-down.
### Details:
Acceptance:
- Ledger view: date range, warehouse, item filters
- Movement view: recent movements; link to item/sale/PO
- Pagination + export
- Tests for filters and navigation

## 9. Nuxt: Refunds flow (back office) [pending]
### Dependencies: None
### Description: Refunds flow for sales back office.
### Details:
Acceptance:
- Refund initiation from sale detail; validations
- CreateRefund API call with idempotency; shows updated receipt
- Audit trail shown; ProblemDetails when forbidden
- Component + e2e tests

## 10. Nuxt: Day-end reports dashboard [pending]
### Dependencies: None
### Description: Day-end reports with export and schedule.
### Details:
Acceptance:
- Dashboard: sales summary, cash position, top items
- Export CSV/PDF via Jobs API
- Schedule daily email via Notifications
- Cypress tests for widgets and exports

## 11. Nuxt: Customer management + segments [pending]
### Dependencies: None
### Description: Customer CRUD and segments with saved filters.
### Details:
Acceptance:
- Customers list/detail/edit
- Segments: create/edit, saved filters applied to list
- Bulk actions: export, notify segment via Notifications
- Component + e2e tests

## 12. Nuxt: AI insights panel wiring [pending]
### Dependencies: None
### Description: AI panel that surfaces insights and suggested actions.
### Details:
Acceptance:
- Right-side AI insights drawer on stock/sales pages
- Calls AI service; shows insight cards + quick actions
- Track outcomes with /outcomes API
- Tests with mocked AI responses

## 13. Nuxt: Real-time updates (SignalR) [pending]
### Dependencies: None
### Description: Real-time updates using SignalR for web.
### Details:
Acceptance:
- SignalR client plugin; auto-reconnect
- Subscriptions to stock changes and sale completed
- UI updates via Pinia stores
- Tests for stream handling

## 14. Nuxt: Design system + shared components [pending]
### Dependencies: None
### Description: Shared design system with Tailwind and component library.
### Details:
Acceptance:
- Tailwind config + base styles
- Shared UI components: DataTable, Modal, FormField, Badge
- Storybook or Histoire docs
- Visual regression on core components

## 15. Nuxt: Accessibility + keyboard nav [pending]
### Dependencies: None
### Description: Keyboard navigation and accessibility.
### Details:
Acceptance:
- Focus traps, skip links, ARIA roles
- Keyboard shortcuts for table nav and actions
- Axe checks in CI; color contrast validated
- E2E tests for keyboard flows

## 16. Nuxt: Testing (Vitest + Cypress) + coverage [pending]
### Dependencies: 13.5
### Description: Unit, component, and e2e testing setup and coverage gate.
### Details:
Acceptance:
- Vitest + Vue Test Utils configured
- Cypress e2e with login helper and API mocks
- Coverage >= 60%; reports uploaded in CI
- Test docs in README

## 17. Nuxt: CI + Docker image + nginx [pending]
### Dependencies: 13.16
### Description: CI pipeline and Docker image for web client.
### Details:
Acceptance:
- CI: install, typecheck, lint, unit, e2e (smoke), build
- Dockerfile for Nuxt server/static as appropriate
- Nginx config for static/cdn; headers and gzip/brotli
- Deploy artifact ready

## 18. Nuxt: Performance analytics + error tracking [pending]
### Dependencies: None
### Description: Performance, analytics, and Sentry.
### Details:
Acceptance:
- Web vitals reporting; route timings
- Sentry or alternative for error tracking
- Consent toggle and PII scrubber
- Dashboard shows captured events

## 19. Nuxt: Docs + deployment guide [pending]
### Dependencies: None
### Description: Docs and deployment steps.
### Details:
Acceptance:
- README: env vars, scripts, dev workflow
- Deploy guide: docker, k8s ingress hints
- Troubleshooting and FAQ
- Badges on README

## 20. Nuxt: Feature flags + settings page [pending]
### Dependencies: None
### Description: Feature toggles and settings page.
### Details:
Acceptance:
- Feature flags plumbed via runtimeConfig/public or backend
- Settings page for user-level prefs (theme, table density)
- Persist to localStorage/cookies
- Unit tests for feature flag logic

