---
description: 
globs: 
alwaysApply: true
---
# TOSS ERP Platform – Full Technical and Functional Documentation

## Table of Contents

1. Introduction
2. Platform Overview
3. Business Objectives
4. Core Features and Modules
5. Personas and User Roles
6. Functional Specifications
7. Technical Architecture
8. Service Interactions and API Contracts
9. Offline and Mobile Support
10. Payment Integrations
11. Reporting and Analytics
12. Authentication and Security
13. Event-Driven Architecture
14. DevOps and Deployment
15. Extensibility and Future Enhancements
16. Glossary

---

## 1. Introduction

**TOSS ERP** is an ERP III-compliant, modular, and scalable platform designed specifically for township and rural small-scale enterprises (SMMEs) in South Africa. It combines the power of traditional ERP systems with AI-driven decision support and platform integration to enable informal and semi-formal businesses to grow, collaborate, and operate with efficiency similar to large organizations.

---

## 2. Platform Overview

* **Product Name:** TOSS ERP
* **Core Purpose:** Empower township-based and rural enterprises with a smart, accessible, and affordable digital business operating system.
* **Design Principles:**

  * Mobile-first, offline-capable
  * Modular microservice-based architecture
  * Built-in AI co-pilot for business decision assistance
  * Peer-to-peer collaborative capabilities
  * Local payment and delivery integrations

---

## 3. Business Objectives

* Enable underserved business owners to digitize daily operations
* Create digital visibility for informal traders
* Facilitate cooperative purchasing and logistics
* Offer built-in intelligence to non-technical users
* Reduce operational costs through automation
* Simplify compliance, audits, and reporting

---

## 4. Core Features and Modules

### 4.1 MVP Modules

* POS & Store Solutions
* Inventory Management
* Invoice Management
* Customer Relationship Management
* Vendor Relationship Management
* Business Co-Pilot Assistant

### 4.2 Extended Modules

* Warehouse Management
* Sales & Marketing
* Cross Commerce (WhatsApp, web store)
* Planning & Merchandising
* Business Intelligence
* Audit & Operations
* Cooperative Management (bulk orders, shared transport)

---

## 5. Personas and User Roles

| Persona                     | Description                                                              |
| --------------------------- | ------------------------------------------------------------------------ |
| **Business Owner**          | Manages all aspects of their shop/salon/store                            |
| **Cashier / Assistant**     | Uses the POS system, checks out customers, logs shifts                   |
| **Co-op Leader**            | Manages group orders, distribution, and logistics for a cluster of SMMEs |
| **Supplier/Vendor**         | Provides inventory and receives payments via the vendor portal           |
| **Driver / Delivery Agent** | Fulfills pickup/drop-off requests between local suppliers and stores     |
| **System Admin**            | Oversees all platform configurations and manages roles                   |
| **AI Co-Pilot**             | Virtual persona providing intelligent prompts, alerts, and guidance      |

---

## 6. Functional Specifications

### 6.1 POS & Store Solutions

* Barcode and quick-scan product selection
* Role-based cashier login
* Multi-tender payment (cash, card, SnapScan, mobile money)
* Dynamic pricing, discounting, tipping
* Offline transaction queue
* Receipt printing (SMS/WhatsApp/PDF)
* Shift management and daily cash-up

### 6.2 Inventory Management

* Product and SKU catalog
* Real-time stock tracking
* Reorder thresholds and alerts
* Multi-location inventory (optional)
* Supplier assignment per item

### 6.3 Invoice Management

* Invoice and quotation generation
* Status tracking (paid/unpaid/refunded)
* Customer linking and loyalty integration
* Export options (PDF, CSV, JSON)

### 6.4 CRM

* Customer profiles and notes
* Loyalty points and visit frequency
* Birthday and promo alert triggers
* Purchase history browsing

### 6.5 Vendor Relationship Management

* Supplier profiles and contracts
* Price and delivery comparison
* Bulk order coordination

### 6.6 Business Co-Pilot

* AI-generated insights ("Sales slow on Thursdays")
* Smart recommendations ("Add more airtime vouchers")
* Guided onboarding
* Automated stock alerts

---

## 7. Technical Architecture

### 7.1 Technologies

* **Frontend Web:** Blazor Server
* **Mobile POS:** Blazor Hybrid (.NET MAUI)
* **Backend:** ASP.NET Core Web API (Clean Architecture, DDD)
* **Database:** PostgreSQL (backend), SQLite (mobile offline)
* **Messaging:** RabbitMQ (event-driven)
* **Authentication:** Duende IdentityServer (OAuth2, JWT)
* **Reporting:** Metabase or Power BI Embedded

### 7.2 Microservices Overview

| Service          | Purpose                                              |
| ---------------- | ---------------------------------------------------- |
| POS.API          | Sales transactions, tipping, discounts, and receipts |
| Inventory.API    | Stock and product tracking                           |
| Catalog.API      | Product metadata, variants, categories               |
| Payment.API      | Integrates with Yoco, SnapScan, mobile wallets       |
| Notification.API | Sends SMS, WhatsApp receipts and alerts              |
| Ordering.API     | Manages completed and refunded orders                |
| Report.API       | Sales, staff, and product performance reports        |
| Identity.API     | Manages authentication, roles, and policies          |

---

## 8. Service Interactions and API Contracts

* `POST /pos/sale`
* `POST /pos/refund/{id}`
* `GET /inventory/products/{sku}`
* `POST /payment/yoco`
* `POST /notification/receipt/whatsapp`
* `GET /report/sales-summary?date=YYYY-MM-DD`

---

## 9. Offline and Mobile Support

* Offline-first Blazor Hybrid mobile POS
* Local storage using SQLite
* Reconnection sync queue with rollback support
* Conflict resolution: deterministic, last-write-wins
* Secure offline encryption and device PIN lock

---

## 10. Payment Integrations

| Method        | Provider       | Integration Type        |
| ------------- | -------------- | ----------------------- |
| Card          | Yoco           | SDK + Bluetooth Pairing |
| QR Scan       | SnapScan       | API + Dynamic QR Code   |
| Mobile Wallet | MTN MoMo       | USSD Push or QR Payment |
| EFT / PayLink | Ozow / Payfast | Redirect or API         |

---

## 11. Reporting and Analytics

* Live sales dashboard
* Inventory valuation and aging reports
* Sales by product, category, and employee
* Daily/weekly/monthly financial summaries
* Top customer and loyalty performance

---

## 12. Authentication and Security

* IdentityServer integration
* JWT authentication between services
* Role-based access policies (Cashier, Supervisor, Admin)
* Device registration and remote logout
* Audit trails and action logging

---

## 13. Event-Driven Architecture

| Event Name                    | Source      | Destination      | Payload                              |
| ----------------------------- | ----------- | ---------------- | ------------------------------------ |
| SaleCompletedIntegrationEvent | POS.API     | Inventory.API    | SKUs and quantities                  |
| PaymentCompletedEvent         | Payment.API | Notification.API | Payment method, amount, contact info |
| RefundProcessedEvent          | POS.API     | Report.API       | Order ID, refund reason, timestamp   |

---

## 14. DevOps and Deployment

* Source control: GitHub + Nx.dev monorepo
* CI/CD: GitHub Actions
* Containerization: Docker
* Orchestration: Kubernetes (Azure AKS)
* Monitoring: Prometheus, Grafana, Application Insights
* Mobile Deployment: Play Store, App Store (via MAUI pipeline)

---

## 15. Extensibility and Future Enhancements

* Loyalty Engine (points, referrals)
* Community Marketplace
* Digital Wallet / Credit Book
* Blockchain for audit trail
* B2B buyer/supplier match-making
* Asset Management (tools, fridges, vehicles)
* AI Forecasting Engine (sales, stock, footfall)

---

## 16. Glossary

* **SMME:** Small, Medium, and Micro Enterprise
* **ERP III:** Modern, AI-enabled, collaborative ERP systems
* **Co-op:** Group of businesses working together for shared buying/promotion
* **POS:** Point-of-Sale – software for checkout and payments
* **MAUI:** .NET Multi-platform App UI
* **P2P Supply Chain:** Decentralized exchange of goods/services between microbusinesses


