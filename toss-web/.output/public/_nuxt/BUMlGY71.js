import{a1 as P,r as m,a2 as A,a3 as z,a4 as I,a5 as U,a6 as D,m as R,k as S,p as w,n as x}from"./Bxwy2Pe9.js";function E(t){return typeof t=="string"?`'${t}'`:new M().serialize(t)}const M=(function(){class t{#e=new Map;compare(e,r){const o=typeof e,a=typeof r;return o==="string"&&a==="string"?e.localeCompare(r):o==="number"&&a==="number"?e-r:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(r,!0))}serialize(e,r){if(e===null)return"null";switch(typeof e){case"string":return r?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const r=Object.prototype.toString.call(e);if(r!=="[object Object]")return this.serializeBuiltInType(r.length<10?`unknown:${r}`:r.slice(8,-1),e);const o=e.constructor,a=o===Object||o===void 0?"":o.name;if(a!==""&&globalThis[a]===o)return this.serializeBuiltInType(a,e);if(typeof e.toJSON=="function"){const i=e.toJSON();return a+(i!==null&&typeof i=="object"?this.$object(i):`(${this.serialize(i)})`)}return this.serializeObjectEntries(a,Object.entries(e))}serializeBuiltInType(e,r){const o=this["$"+e];if(o)return o.call(this,r);if(typeof r?.entries=="function")return this.serializeObjectEntries(e,r.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,r){const o=Array.from(r).sort((i,c)=>this.compare(i[0],c[0]));let a=`${e}{`;for(let i=0;i<o.length;i++){const[c,u]=o[i];a+=`${this.serialize(c,!0)}:${this.serialize(u)}`,i<o.length-1&&(a+=",")}return a+"}"}$object(e){let r=this.#e.get(e);return r===void 0&&(this.#e.set(e,`#${this.#e.size}`),r=this.serializeObject(e),this.#e.set(e,r)),r}$function(e){const r=Function.prototype.toString.call(e);return r.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${r.replace(/\s*\n\s*/g,"")}`}$Array(e){let r="[";for(let o=0;o<e.length;o++)r+=this.serialize(e[o]),o<e.length-1&&(r+=",");return r+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((r,o)=>this.compare(r,o)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const n of["Error","RegExp","URL"])t.prototype["$"+n]=function(e){return`${n}(${e})`};for(const n of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])t.prototype["$"+n]=function(e){return`${n}[${e.join(",")}]`};for(const n of["BigInt64Array","BigUint64Array"])t.prototype["$"+n]=function(e){return`${n}[${e.join("n,")}${e.length>0?"n":""}]`};return t})();function B(t,n){return t===n||E(t)===E(n)}function L(t,n){if(typeof t!="string")throw new TypeError("argument str must be a string");const e={},r=n||{},o=r.decode||F;let a=0;for(;a<t.length;){const i=t.indexOf("=",a);if(i===-1)break;let c=t.indexOf(";",a);if(c===-1)c=t.length;else if(c<i){a=t.lastIndexOf(";",i-1)+1;continue}const u=t.slice(a,i).trim();if(r?.filter&&!r?.filter(u)){a=c+1;continue}if(e[u]===void 0){let f=t.slice(i+1,c).trim();f.codePointAt(0)===34&&(f=f.slice(1,-1)),e[u]=_(f,o)}a=c+1}return e}function F(t){return t.includes("%")?decodeURIComponent(t):t}function _(t,n){try{return n(t)}catch{return t}}const v=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function O(t,n,e){const r=e||{},o=r.encode||encodeURIComponent;if(typeof o!="function")throw new TypeError("option encode is invalid");if(!v.test(t))throw new TypeError("argument name is invalid");const a=o(n);if(a&&!v.test(a))throw new TypeError("argument val is invalid");let i=t+"="+a;if(r.maxAge!==void 0&&r.maxAge!==null){const c=r.maxAge-0;if(Number.isNaN(c)||!Number.isFinite(c))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(c)}if(r.domain){if(!v.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!v.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!H(r.expires)||Number.isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":{i+="; Priority=Low";break}case"medium":{i+="; Priority=Medium";break}case"high":{i+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:{i+="; SameSite=Strict";break}case"lax":{i+="; SameSite=Lax";break}case"strict":{i+="; SameSite=Strict";break}case"none":{i+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(i+="; Partitioned"),i}function H(t){return Object.prototype.toString.call(t)==="[object Date]"||t instanceof Date}function h(t){if(typeof t!="object")return t;var n,e,r=Object.prototype.toString.call(t);if(r==="[object Object]"){if(t.constructor!==Object&&typeof t.constructor=="function"){e=new t.constructor;for(n in t)t.hasOwnProperty(n)&&e[n]!==t[n]&&(e[n]=h(t[n]))}else{e={};for(n in t)n==="__proto__"?Object.defineProperty(e,n,{value:h(t[n]),configurable:!0,enumerable:!0,writable:!0}):e[n]=h(t[n])}return e}if(r==="[object Array]"){for(n=t.length,e=Array(n);n--;)e[n]=h(t[n]);return e}return r==="[object Set]"?(e=new Set,t.forEach(function(o){e.add(h(o))}),e):r==="[object Map]"?(e=new Map,t.forEach(function(o,a){e.set(h(a),h(o))}),e):r==="[object Date]"?new Date(+t):r==="[object RegExp]"?(e=new RegExp(t.source,t.flags),e.lastIndex=t.lastIndex,e):r==="[object DataView]"?new t.constructor(h(t.buffer)):r==="[object ArrayBuffer]"?t.slice(0):r.slice(-6)==="Array]"?new t.constructor(t):t}const J={path:"/",watch:!0,decode:t=>P(decodeURIComponent(t)),encode:t=>encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},b=window.cookieStore;function k(t,n){const e={...J,...n};e.filter??=f=>f===t;const r=C(e)||{};let o;e.maxAge!==void 0?o=e.maxAge*1e3:e.expires&&(o=e.expires.getTime()-Date.now());const a=o!==void 0&&o<=0,i=a||r[t]===void 0||r[t]===null,c=h(a?void 0:r[t]??e.default?.()),u=o&&!a?X(c,o,e.watch&&e.watch!=="shallow"):m(c);{let f=null;try{!b&&typeof BroadcastChannel<"u"&&(f=new BroadcastChannel(`nuxt:cookies:${t}`))}catch{}const d=(p=!1)=>{!p&&(e.readonly||B(u.value,r[t]))||(q(t,u.value,e),r[t]=h(u.value),f?.postMessage({value:e.encode(u.value)}))},y=p=>{const g=p.refresh?C(e)?.[t]:e.decode(p.value);l=!0,u.value=g,r[t]=h(g),D(()=>{l=!1})};let l=!1;const s=!!I();if(s&&A(()=>{l=!0,d(),f?.close()}),b){const p=g=>{const j=g.changed.find($=>$.name===t),N=g.deleted.find($=>$.name===t);j&&y({value:j.value}),N&&y({value:null})};b.addEventListener("change",p),s&&A(()=>b.removeEventListener("change",p))}else f&&(f.onmessage=({data:p})=>y(p));e.watch&&z(u,()=>{l||d()},{deep:e.watch!=="shallow"}),i&&d(i)}return u}function C(t={}){return L(document.cookie,t)}function V(t,n,e={}){return n==null?O(t,n,{...e,maxAge:-1}):O(t,n,e)}function q(t,n,e={}){document.cookie=V(t,n,e)}const T=2147483647;function X(t,n,e){let r,o,a=0;const i=e?m(t):{value:t};return I()&&A(()=>{o?.(),clearTimeout(r)}),U((c,u)=>{e&&(o=z(i,u));function f(){a=0,clearTimeout(r);const d=n-a,y=d<T?d:T;r=setTimeout(()=>{if(a+=y,a<n)return f();i.value=void 0,u()},y)}return{get(){return c(),i.value},set(d){f(),i.value=d,u()}}})}const G=R("user",()=>{const t=m(null),n=m(!1),e=m(!1),r=m([]),o=S(()=>t.value?`${t.value.firstName} ${t.value.lastName}`:""),a=S(()=>l=>r.value.includes(l)||r.value.includes("admin")),i=S(()=>{if(!t.value)return"U";const l=t.value.firstName?.[0]||"",s=t.value.lastName?.[0]||"";return(l+s).toUpperCase()});async function c(l){e.value=!0;try{const s=await $fetch("/api/auth/login",{method:"POST",body:l});if(t.value=s.user,n.value=!0,r.value=s.permissions||[],s.token){const p=k("auth-token",{default:()=>null,secure:!0,sameSite:"strict",maxAge:604800});p.value=s.token}return s}catch(s){throw s}finally{e.value=!1}}async function u(){e.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"})}catch(l){console.error("Logout error:",l)}finally{t.value=null,n.value=!1,r.value=[],e.value=!1;const l=k("auth-token");l.value=null,await x("/login")}}async function f(){if(!k("auth-token").value)return!1;e.value=!0;try{const s=await $fetch("/api/auth/me");return t.value=s.user,n.value=!0,r.value=s.permissions||[],!0}catch{return await u(),!1}finally{e.value=!1}}async function d(l){e.value=!0;try{const s=await $fetch("/api/user/profile",{method:"PATCH",body:l});return t.value={...t.value,...s.user},s}catch(s){throw s}finally{e.value=!1}}async function y(l){e.value=!0;try{return await $fetch("/api/user/change-password",{method:"POST",body:l})}catch(s){throw s}finally{e.value=!1}}return{user:w(t),isAuthenticated:w(n),loading:w(e),permissions:w(r),fullName:o,hasPermission:a,userInitials:i,login:c,logout:u,checkAuth:f,updateProfile:d,changePassword:y}});export{G as u};
